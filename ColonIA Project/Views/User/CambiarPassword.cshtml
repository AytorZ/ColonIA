@using (Html.BeginForm("CambiarPassword", "User", FormMethod.Post))
{
    <input type="password" name="nuevaContrasena" placeholder="Nueva contraseña" required class="form-control" />
    <button type="submit" class="btn btn-primary">Cambiar</button>
}
@section Scripts {
    <script>
            document.getElementById('emailForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const email = document.getElementById('email').value;

                const response = await fetch('/User/EnviarCodigo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ correo: email })
                });

                const result = await response.json();
                if (result.success) {
                    document.getElementById('emailFormSection').style.display = 'none';
                    document.getElementById('verificationFormSection').style.display = 'block';
                } else {
                    document.getElementById('formMessage').textContent = result.message;
                    document.getElementById('formMessage').style.display = 'block';
                }
            });

            document.getElementById('codeForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const code = document.getElementById('verificationCode').value;

                const response = await fetch('/User/VerificarCodigo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ correo: email, codigo: code })
                });

                const result = await response.json();
                if (result.success) {
                    window.location.href = '/User/CambiarPassword';
                } else {
                    document.getElementById('verificationMessage').textContent = result.message;
                    document.getElementById('verificationMessage').style.display = 'block';
                }
            });
        </script>
}
}